<script type="text/template" id="item_template">
  <% _.each(fields, function(fieldItem) { %>
    <fieldset>
      <legend class="sr-only">{{ page.t.indicator.sub_categories }} - <%=translations.t(fieldItem.field)%></legend>
      <% if(allowedFields.indexOf(fieldItem.field) == -1) { %>
        <div class="variable-selector disallowed child" data-field="<%=fieldItem.field%>">
          <button class='accessBtn' tabindex='0' aria-expanded='false' aria-describedby="variable-hint-<%=fieldItem.field%>">
            <h5><%=translations.t(fieldItem.field)%><i class="fa fa-chevron-down"></i></h5>
          </button>
          <div class="bar">
            <div class="selected"></div>
          </div>
          <div class="variable-options">
            <div>
              <button data-type="select">{{ page.t.indicator.select_all }}</button>
              <button data-type="clear">{{ page.t.indicator.clear_all }}</button>
            </div>
            <% _.each(fieldItem.values, function(item) { %>
              <label>
                <input type="checkbox" <%=item.checked ? 'checked' : ''%> value="<%=item.value%>" data-field="<%=fieldItem.field%>" /><%=translations.t(item.value)%>
              </label>
            <% }); %>
          </div>
          <div class="variable-hint" id="variable-hint-<%=fieldItem.field%>">
            {%- capture var_hint_replacement -%}
              {% raw %}<%= translations.t(_.findWhere(edges, { To: fieldItem.field }).From) %>{% endraw %}
            {%- endcapture -%}
            {{ page.t.indicator.variable_hint | replace_first: '%field', var_hint_replacement }}
          </div>
          <div class="no-data-hint">
            {{ page.t.indicator.no_data_hint }}
          </div>
        </div>
      <% }
      else 
      {
      %>
        <div class="variable-selector<% data-field="<%=fieldItem.field%>">
          <button class='accessBtn' tabindex='0' aria-expanded='false'>
            <h5><%=translations.t(fieldItem.field)%><i class="fa fa-chevron-down"></i></h5>
          </button>
          <div class="bar">
            <div class="selected"></div>
          </div>
          <div class="variable-options">
            <div>
              <button data-type="select">{{ page.t.indicator.select_all }}</button>
              <button data-type="clear">{{ page.t.indicator.clear_all }}</button>
            </div>
            <% _.each(fieldItem.values, function(item) { %>
              <label>
                <input type="checkbox" <%=item.checked ? 'checked' : ''%> value="<%=item.value%>" data-field="<%=fieldItem.field%>" /><%=translations.t(item.value)%>
              </label>
            <% }); %>
          </div>
        </div>
      <% } %>

      
    </fieldset>
  <% }); %>
</script>
